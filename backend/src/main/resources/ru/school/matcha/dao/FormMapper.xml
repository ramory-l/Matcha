<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ru.school.matcha.dao.FormMapper">

    <resultMap id="Form" type="ru.school.matcha.domain.Form">
        <id property="id" column="id"/>
        <result property="man" column="man"/>
        <result property="woman" column="woman"/>
        <result property="friendship" column="friendship"/>
        <result property="love" column="love"/>
        <result property="sex" column="sex"/>
        <result property="flirt" column="flirt"/>
    </resultMap>

    <insert id="createForm" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO form (man,
                          woman,
                          friendship,
                          love,
                          sex,
                          flirt)
        VALUES (#{man},
                #{woman},
                #{friendship},
                #{love},
                #{sex},
                #{flirt})
    </insert>

    <update id="updateFormById">
        UPDATE form SET
        <if test="man != null">
            man = #{man},
        </if>
        <if test="woman != null">
            woman = #{woman},
        </if>
        <if test="friendship != null">
            friendship = #{friendship},
        </if>
        <if test="love != null">
            love = #{love},
        </if>
        <if test="sex != null">
            sex = #{sex},
        </if>
        <if test="flirt != null">
            flirt = #{flirt}
        </if>
        WHERE id = #{id}
    </update>

    <delete id="deleteFormById">
        DELETE
        FROM form
        WHERE id = #{id}
    </delete>

    <delete id="deleteAllInactiveForms">
        DELETE
        FROM form
        WHERE id not in (SELECT form_id FROM "user")
    </delete>

    <select id="getAllForms" resultMap="Form">
        SELECT *
        FROM form
    </select>

    <select id="getFormById" resultMap="Form">
        SELECT *
        FROM form
        WHERE id = #{id}
    </select>

</mapper>